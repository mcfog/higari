{"version":3,"sources":["webpack:///webpack/bootstrap df2515140c5f861488f2?dc5d","webpack:///./js/rank.main.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAC;;AAED;AACA,kDAAiD,kBAAkB;AACnE;AACA;AACA,EAAC;;AAED;AACA;AACA,+BAA8B,EAAE,IAAI,IAAI;AACxC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA,kBAAiB;;AAEjB;AACA,cAAa;AACb;AACA;AACA;AACA;;AAEA;AACA,cAAa;AACb;AACA;;AAEA;AACA,UAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA,UAAS;;AAET;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;;AAEA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;AACL,0CAAyC,cAAc;;AAEvD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAS;AACT","file":"rank.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap df2515140c5f861488f2\n **/","\nriot.route(function (hash) {\n    var parts = hash.slice(1).split(/\\//g);\n    if (!routes[parts[0]]) {\n        location = '/';\n        return;\n    }\n\n    routes[parts[0]].apply(null, parts.slice(1));\n});\n\nvar list = [];\nvar option = JSON.parse(localStorage.option || '{\"order\":\"default\"}');\nvar render = _.throttle(renderNow, 150, {\n    leading: false\n});\n\nvar routes = {\n    season: function (season) {\n        if (!season.match(/\\d{4}-\\d{1,2}/)) {\n            location = '/';\n            return;\n        }\n\n        $.get('http://7xqy5q.com1.z0.glb.clouddn.com/' + season + '.json?' + (localStorage.timestamp || parseInt(Date.now() / 7200000)))\n            .then(function (o) {\n                list = o;\n                optionChange(true);\n            });\n    }\n};\n\n$(document)\n    .on('lazybeforeunveil', '.ctn-list>.row', lazyload)\n    .on('change', '.control-panel *', optionChange);\n\nfunction optionChange(event) {\n    var $cp = $('.control-panel');\n    var init = event === true;\n\n    input('order');\n    checkbox('hentai');\n    checkbox('rateBy');\n    checkbox('small');\n\n    if(!init) {\n        localStorage.option = JSON.stringify(option);\n    }\n\n    init ? renderNow() : render();\n\n    function checkbox(name) {\n        var $control = $('[name=' + name + ']', $cp);\n        if(init) {\n            $control.prop('checked', !!option[name]);\n            return;\n        }\n\n        option[name] = !!$control.prop('checked');\n    }\n\n    function input(name) {\n        var $control = $('[name=' + name + ']', $cp);\n        if(init) {\n            $control.val(option[name]);\n            return;\n        }\n\n        option[name] = $control.val();\n    }\n\n}\n\nfunction filter(list) {\n    return _(list)\n        .filter(function (item) {\n            return !option.hentai ^ hentai(item);\n        })\n        .filter(function (item) {\n            return !option.rateBy || item.rateBy;\n        })\n        .sortBy(function (item, idx) {\n            if (option.order === 'default') {\n                return -power(item);\n            } else if (option.order === 'fav') {\n                var sum = 0;\n                _.each(item.detail.audience, function (count) {\n                    sum += count;\n                });\n\n                return -sum;\n            } else if (option.order === 'rate') {\n                var rate = item.rate;\n                if (item.detail.rank) {\n                    rate -= 0.0000001 * item.detail.rank;\n                }\n\n                return -rate;\n            } else if (option.order === 'rater') {\n                return -(item.rateBy || 0);\n            }\n\n            return idx;\n        })\n        .value();\n}\n\nfunction hentai(item) {\n    return 'hentai' in item.detail \n        ? item.detail.hentai\n        : (item.detail.tags.filter(function (tag) {\n            return -1 !== _.indexOf(['里番', '肉番', 'H', '18禁'], tag.text);\n        }).length > 0);\n}\n\nfunction goodAudience(item) {\n    var audience = item.detail.audience;\n    var rate = 0;\n    take('collections', 1.5);\n    take('doings', 0.8);\n    take('wishes', 0.5);\n    take('dropped', -4);\n    take('on_hold', -2);\n\n    return rate;\n\n    function take(key, weight) {\n        rate += (audience[key] || 0) * weight;\n    }\n}\n\nfunction power(item) {\n    return Math.pow(item.rate / 10, 0.75) * goodAudience(item);\n}\n\nfunction renderNow() {\n    var $list = $('.ctn-list');\n    $list.empty().fadeTo(1, 0.01, function () {\n        var tpl = $('#tpl-list').html();\n        filter(list).forEach(function (item, idx) {\n            var $row = $('<div class=\"row lazyload\">').html(\n                _.template(tpl)({\n                    item: item,\n                    option: option\n                })\n            ).data('row-item', item);\n            $list.append($row);\n        });\n\n        $list.fadeTo('normal', 1);\n    });\n}\n\nfunction lazyload(event) {\n    var $row = $(event.target);\n    var item = $row.data('row-item');\n    var id = _.uniqueId();\n    $('.audience-chart', $row).attr('id', '_ac_' + id);\n    renderDonut(item, '_ac_' + id);\n\n    $('.gauge-chart', $row).attr('id', '_g_' + id);\n    renderGauge(item, '_g_' + id);\n\n    $('.rate-chart', $row).attr('id', '_r_' + id);\n    renderRate(item, '_r_' + id);\n\n    renderTags(item, $('.tags', $row));\n}\nfunction renderDonut(item, id) {\n    var columns = [];\n    var sum = 0;\n\n    pushCol('想看', 'wishes');\n    pushCol('在看', 'doings');\n    pushCol('看过', 'collections');\n    pushCol('搁置', 'on_hold');\n    pushCol('抛弃', 'dropped');\n\n    function pushCol(name, key) {\n        var count = item.detail.audience[key] || 0;\n        sum += count;\n        columns.push([name, count]);\n    }\n\n    return c3.generate({\n        size: {\n            height: option.small ? 200 : 300\n        },\n        data: {\n            columns: columns,\n            order: null,\n            type: 'donut'\n        },\n        donut: {\n            title: option.small ? '' : sum + '人收藏'\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderRate(item, id) {\n\n    var column = [];\n    var x = [];\n\n    item.detail.rate.forEach(function (item) {\n        x.push(item.rate);\n        column.push(item.count);\n    });\n\n    column.unshift('rate');\n\n    return c3.generate({\n        size: {\n            height: 240\n        },\n        data: {\n            columns: [column],\n            order: null,\n            type: option.small ? 'bar' : 'area-spline'\n        },\n        axis: {\n            x: {\n                type: 'category',\n                categories: x\n            }\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderGauge(item, id) {\n    return c3.generate({\n        size: {\n            height: 150\n        },\n        data: {\n            columns: [\n                ['评分', item.rate || 0]\n            ],\n            type: 'gauge'\n        },\n        gauge: {\n            min: 5,\n            max: 9,\n            label: {\n                format: function (value, ratio) {\n                    if (!item.rateBy) {\n                        return '评分暂缺';\n                    }\n                    return value.toFixed(1) + '*' + item.rateBy + '人';\n                }\n            }\n        },\n        color: {\n            pattern: ['#AAAAAA', '#2ECC40', '#FF851B', '#FF4136'],\n            threshold: {\n                values: [6.0, 7.5, 9.0]\n            }\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderTags(item, $tags) {\n    var cssClass = 'label-primary label-info label-success label-warning label-danger'.split(/ /g);\n    var max = 0;\n    var year = new Date().getFullYear();\n    var tags = item.detail.tags.filter(function (tag) {\n        return -1 === tag.text.indexOf(year);\n    });\n\n    tags.forEach(function (tag) {\n        max = Math.max(max, tag.count);\n    });\n    var rand = Math.seedrandom(item.id, {global: false});\n\n    function pick() {\n        var ans = parseInt(rand() * cssClass.length);\n\n        if (ans == pick.last) {\n            ans = parseInt(rand() * cssClass.length);\n        }\n\n        if (ans == pick.last) {\n            return pick.last = ans = parseInt(rand() * cssClass.length);\n        }\n\n        return pick.last = ans;\n    }\n\n    tags\n//        .sort(function (a, b) {\n//            return b.count - a.count;\n//        })\n        .forEach(function (tag) {\n            var $tag = $('<a>');\n            var weight = Math.pow(tag.count / max, 0.5);\n            $tag\n                .attr('title', '* ' + tag.count)\n                .addClass('label')\n                .addClass(cssClass[pick()])\n                .css('opacity', 0.4 + 0.8 * weight)\n                .css('transform', 'scale('+(Math.min(1, 0.8 + 0.3 * weight))+')')\n                .text(tag.text);\n\n            $tags.append($tag).append(' ');\n        });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./js/rank.main.js\n ** module id = 0\n ** module chunks = 1\n **/"],"sourceRoot":""}