{"version":3,"sources":["webpack:///rank.min.js","webpack:///webpack/bootstrap c70e230ab7a3bbe2592a?21aa*","webpack:///./js/rank.main.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","optionChange","event","checkbox","name","$control","$","$cp","init","prop","option","input","val","localStorage","JSON","stringify","renderNow","render","filter","list","_","item","hentai","rateBy","sortBy","idx","order","power","sum","each","detail","audience","count","rate","rank","value","tags","tag","indexOf","text","length","goodAudience","take","key","weight","Math","pow","$list","empty","fadeTo","tpl","html","forEach","$row","template","data","append","lazyload","target","uniqueId","attr","renderDonut","renderGauge","renderRate","renderTags","pushCol","columns","push","c3","generate","size","height","small","type","donut","title","bindto","column","x","unshift","axis","categories","gauge","min","max","label","format","ratio","toFixed","color","pattern","threshold","values","$tags","pick","ans","parseInt","rand","cssClass","last","split","year","Date","getFullYear","seedrandom","global","$tag","addClass","css","riot","route","hash","parts","slice","routes","apply","location","parse","throttle","leading","season","match","get","timestamp","now","then","o","document","on"],"mappings":"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","file":"rank.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports) {\n\n\t\n\triot.route(function (hash) {\n\t    var parts = hash.slice(1).split(/\\//g);\n\t    if (!routes[parts[0]]) {\n\t        location = '/';\n\t        return;\n\t    }\n\t\n\t    routes[parts[0]].apply(null, parts.slice(1));\n\t});\n\t\n\tvar list = [];\n\tvar option = JSON.parse(localStorage.option || '{\"order\":\"default\"}');\n\tvar render = _.throttle(renderNow, 150, {\n\t    leading: false\n\t});\n\t\n\tvar routes = {\n\t    season: function (season) {\n\t        if (!season.match(/\\d{4}-\\d{1,2}/)) {\n\t            location = '/';\n\t            return;\n\t        }\n\t\n\t        $.get('http://7xqy5q.com1.z0.glb.clouddn.com/' + season + '.json?' + (localStorage.timestamp || parseInt(Date.now() / 7200000)))\n\t            .then(function (o) {\n\t                list = o;\n\t                optionChange(true);\n\t            });\n\t    }\n\t};\n\t\n\t$(document)\n\t    .on('lazybeforeunveil', '.ctn-list>.row', lazyload)\n\t    .on('change', '.control-panel *', optionChange);\n\t\n\tfunction optionChange(event) {\n\t    var $cp = $('.control-panel');\n\t    var init = event === true;\n\t\n\t    input('order');\n\t    checkbox('hentai');\n\t    checkbox('rateBy');\n\t    checkbox('small');\n\t\n\t    if(!init) {\n\t        localStorage.option = JSON.stringify(option);\n\t    }\n\t\n\t    init ? renderNow() : render();\n\t\n\t    function checkbox(name) {\n\t        var $control = $('[name=' + name + ']', $cp);\n\t        if(init) {\n\t            $control.prop('checked', !!option[name]);\n\t            return;\n\t        }\n\t\n\t        option[name] = !!$control.prop('checked');\n\t    }\n\t\n\t    function input(name) {\n\t        var $control = $('[name=' + name + ']', $cp);\n\t        if(init) {\n\t            $control.val(option[name]);\n\t            return;\n\t        }\n\t\n\t        option[name] = $control.val();\n\t    }\n\t\n\t}\n\t\n\tfunction filter(list) {\n\t    return _(list)\n\t        .filter(function (item) {\n\t            return !option.hentai ^ hentai(item);\n\t        })\n\t        .filter(function (item) {\n\t            return !option.rateBy || item.rateBy;\n\t        })\n\t        .sortBy(function (item, idx) {\n\t            if (option.order === 'default') {\n\t                return -power(item);\n\t            } else if (option.order === 'fav') {\n\t                var sum = 0;\n\t                _.each(item.detail.audience, function (count) {\n\t                    sum += count;\n\t                });\n\t\n\t                return -sum;\n\t            } else if (option.order === 'rate') {\n\t                var rate = item.rate;\n\t                if (item.detail.rank) {\n\t                    rate -= 0.0000001 * item.detail.rank;\n\t                }\n\t\n\t                return -rate;\n\t            } else if (option.order === 'rater') {\n\t                return -(item.rateBy || 0);\n\t            }\n\t\n\t            return idx;\n\t        })\n\t        .value();\n\t}\n\t\n\tfunction hentai(item) {\n\t    return 'hentai' in item.detail \n\t        ? item.detail.hentai\n\t        : (item.detail.tags.filter(function (tag) {\n\t            return -1 !== _.indexOf(['里番', '肉番', 'H', '18禁'], tag.text);\n\t        }).length > 0);\n\t}\n\t\n\tfunction goodAudience(item) {\n\t    var audience = item.detail.audience;\n\t    var rate = 0;\n\t    take('collections', 1.5);\n\t    take('doings', 0.8);\n\t    take('wishes', 0.5);\n\t    take('dropped', -4);\n\t    take('on_hold', -2);\n\t\n\t    return rate;\n\t\n\t    function take(key, weight) {\n\t        rate += (audience[key] || 0) * weight;\n\t    }\n\t}\n\t\n\tfunction power(item) {\n\t    return Math.pow(item.rate / 10, 0.75) * goodAudience(item);\n\t}\n\t\n\tfunction renderNow() {\n\t    var $list = $('.ctn-list');\n\t    $list.empty().fadeTo(1, 0.01, function () {\n\t        var tpl = $('#tpl-list').html();\n\t        filter(list).forEach(function (item, idx) {\n\t            var $row = $('<div class=\"row lazyload\">').html(\n\t                _.template(tpl)({\n\t                    item: item,\n\t                    option: option\n\t                })\n\t            ).data('row-item', item);\n\t            $list.append($row);\n\t        });\n\t\n\t        $list.fadeTo('normal', 1);\n\t    });\n\t}\n\t\n\tfunction lazyload(event) {\n\t    var $row = $(event.target);\n\t    var item = $row.data('row-item');\n\t    var id = _.uniqueId();\n\t    $('.audience-chart', $row).attr('id', '_ac_' + id);\n\t    renderDonut(item, '_ac_' + id);\n\t\n\t    $('.gauge-chart', $row).attr('id', '_g_' + id);\n\t    renderGauge(item, '_g_' + id);\n\t\n\t    $('.rate-chart', $row).attr('id', '_r_' + id);\n\t    renderRate(item, '_r_' + id);\n\t\n\t    renderTags(item, $('.tags', $row));\n\t}\n\tfunction renderDonut(item, id) {\n\t    var columns = [];\n\t    var sum = 0;\n\t\n\t    pushCol('想看', 'wishes');\n\t    pushCol('在看', 'doings');\n\t    pushCol('看过', 'collections');\n\t    pushCol('搁置', 'on_hold');\n\t    pushCol('抛弃', 'dropped');\n\t\n\t    function pushCol(name, key) {\n\t        var count = item.detail.audience[key] || 0;\n\t        sum += count;\n\t        columns.push([name, count]);\n\t    }\n\t\n\t    return c3.generate({\n\t        size: {\n\t            height: option.small ? 200 : 300\n\t        },\n\t        data: {\n\t            columns: columns,\n\t            order: null,\n\t            type: 'donut'\n\t        },\n\t        donut: {\n\t            title: option.small ? '' : sum + '人收藏'\n\t        },\n\t        bindto: '#' + id\n\t    });\n\t}\n\t\n\tfunction renderRate(item, id) {\n\t\n\t    var column = [];\n\t    var x = [];\n\t\n\t    item.detail.rate.forEach(function (item) {\n\t        x.push(item.rate);\n\t        column.push(item.count);\n\t    });\n\t\n\t    column.unshift('rate');\n\t\n\t    return c3.generate({\n\t        size: {\n\t            height: 240\n\t        },\n\t        data: {\n\t            columns: [column],\n\t            order: null,\n\t            type: option.small ? 'bar' : 'area-spline'\n\t        },\n\t        axis: {\n\t            x: {\n\t                type: 'category',\n\t                categories: x\n\t            }\n\t        },\n\t        bindto: '#' + id\n\t    });\n\t}\n\t\n\tfunction renderGauge(item, id) {\n\t    return c3.generate({\n\t        size: {\n\t            height: 150\n\t        },\n\t        data: {\n\t            columns: [\n\t                ['评分', item.rate || 0]\n\t            ],\n\t            type: 'gauge'\n\t        },\n\t        gauge: {\n\t            min: 5,\n\t            max: 9,\n\t            label: {\n\t                format: function (value, ratio) {\n\t                    if (!item.rateBy) {\n\t                        return '评分暂缺';\n\t                    }\n\t                    return value.toFixed(1) + '*' + item.rateBy + '人';\n\t                }\n\t            }\n\t        },\n\t        color: {\n\t            pattern: ['#AAAAAA', '#2ECC40', '#FF851B', '#FF4136'],\n\t            threshold: {\n\t                values: [6.0, 7.5, 9.0]\n\t            }\n\t        },\n\t        bindto: '#' + id\n\t    });\n\t}\n\t\n\tfunction renderTags(item, $tags) {\n\t    var cssClass = 'label-primary label-info label-success label-warning label-danger'.split(/ /g);\n\t    var max = 0;\n\t    var year = new Date().getFullYear();\n\t    var tags = item.detail.tags.filter(function (tag) {\n\t        return -1 === tag.text.indexOf(year);\n\t    });\n\t\n\t    tags.forEach(function (tag) {\n\t        max = Math.max(max, tag.count);\n\t    });\n\t    var rand = Math.seedrandom(item.id, {global: false});\n\t\n\t    function pick() {\n\t        var ans = parseInt(rand() * cssClass.length);\n\t\n\t        if (ans == pick.last) {\n\t            ans = parseInt(rand() * cssClass.length);\n\t        }\n\t\n\t        if (ans == pick.last) {\n\t            return pick.last = ans = parseInt(rand() * cssClass.length);\n\t        }\n\t\n\t        return pick.last = ans;\n\t    }\n\t\n\t    tags\n\t//        .sort(function (a, b) {\n\t//            return b.count - a.count;\n\t//        })\n\t        .forEach(function (tag) {\n\t            var $tag = $('<a>');\n\t            var weight = Math.pow(tag.count / max, 0.5);\n\t            $tag\n\t                .attr('title', '* ' + tag.count)\n\t                .addClass('label')\n\t                .addClass(cssClass[pick()])\n\t                .css('opacity', 0.4 + 0.8 * weight)\n\t                .css('transform', 'scale('+(Math.min(1, 0.8 + 0.3 * weight))+')')\n\t                .text(tag.text);\n\t\n\t            $tags.append($tag).append(' ');\n\t        });\n\t}\n\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** rank.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c70e230ab7a3bbe2592a\n **/","\nriot.route(function (hash) {\n    var parts = hash.slice(1).split(/\\//g);\n    if (!routes[parts[0]]) {\n        location = '/';\n        return;\n    }\n\n    routes[parts[0]].apply(null, parts.slice(1));\n});\n\nvar list = [];\nvar option = JSON.parse(localStorage.option || '{\"order\":\"default\"}');\nvar render = _.throttle(renderNow, 150, {\n    leading: false\n});\n\nvar routes = {\n    season: function (season) {\n        if (!season.match(/\\d{4}-\\d{1,2}/)) {\n            location = '/';\n            return;\n        }\n\n        $.get('http://7xqy5q.com1.z0.glb.clouddn.com/' + season + '.json?' + (localStorage.timestamp || parseInt(Date.now() / 7200000)))\n            .then(function (o) {\n                list = o;\n                optionChange(true);\n            });\n    }\n};\n\n$(document)\n    .on('lazybeforeunveil', '.ctn-list>.row', lazyload)\n    .on('change', '.control-panel *', optionChange);\n\nfunction optionChange(event) {\n    var $cp = $('.control-panel');\n    var init = event === true;\n\n    input('order');\n    checkbox('hentai');\n    checkbox('rateBy');\n    checkbox('small');\n\n    if(!init) {\n        localStorage.option = JSON.stringify(option);\n    }\n\n    init ? renderNow() : render();\n\n    function checkbox(name) {\n        var $control = $('[name=' + name + ']', $cp);\n        if(init) {\n            $control.prop('checked', !!option[name]);\n            return;\n        }\n\n        option[name] = !!$control.prop('checked');\n    }\n\n    function input(name) {\n        var $control = $('[name=' + name + ']', $cp);\n        if(init) {\n            $control.val(option[name]);\n            return;\n        }\n\n        option[name] = $control.val();\n    }\n\n}\n\nfunction filter(list) {\n    return _(list)\n        .filter(function (item) {\n            return !option.hentai ^ hentai(item);\n        })\n        .filter(function (item) {\n            return !option.rateBy || item.rateBy;\n        })\n        .sortBy(function (item, idx) {\n            if (option.order === 'default') {\n                return -power(item);\n            } else if (option.order === 'fav') {\n                var sum = 0;\n                _.each(item.detail.audience, function (count) {\n                    sum += count;\n                });\n\n                return -sum;\n            } else if (option.order === 'rate') {\n                var rate = item.rate;\n                if (item.detail.rank) {\n                    rate -= 0.0000001 * item.detail.rank;\n                }\n\n                return -rate;\n            } else if (option.order === 'rater') {\n                return -(item.rateBy || 0);\n            }\n\n            return idx;\n        })\n        .value();\n}\n\nfunction hentai(item) {\n    return 'hentai' in item.detail \n        ? item.detail.hentai\n        : (item.detail.tags.filter(function (tag) {\n            return -1 !== _.indexOf(['里番', '肉番', 'H', '18禁'], tag.text);\n        }).length > 0);\n}\n\nfunction goodAudience(item) {\n    var audience = item.detail.audience;\n    var rate = 0;\n    take('collections', 1.5);\n    take('doings', 0.8);\n    take('wishes', 0.5);\n    take('dropped', -4);\n    take('on_hold', -2);\n\n    return rate;\n\n    function take(key, weight) {\n        rate += (audience[key] || 0) * weight;\n    }\n}\n\nfunction power(item) {\n    return Math.pow(item.rate / 10, 0.75) * goodAudience(item);\n}\n\nfunction renderNow() {\n    var $list = $('.ctn-list');\n    $list.empty().fadeTo(1, 0.01, function () {\n        var tpl = $('#tpl-list').html();\n        filter(list).forEach(function (item, idx) {\n            var $row = $('<div class=\"row lazyload\">').html(\n                _.template(tpl)({\n                    item: item,\n                    option: option\n                })\n            ).data('row-item', item);\n            $list.append($row);\n        });\n\n        $list.fadeTo('normal', 1);\n    });\n}\n\nfunction lazyload(event) {\n    var $row = $(event.target);\n    var item = $row.data('row-item');\n    var id = _.uniqueId();\n    $('.audience-chart', $row).attr('id', '_ac_' + id);\n    renderDonut(item, '_ac_' + id);\n\n    $('.gauge-chart', $row).attr('id', '_g_' + id);\n    renderGauge(item, '_g_' + id);\n\n    $('.rate-chart', $row).attr('id', '_r_' + id);\n    renderRate(item, '_r_' + id);\n\n    renderTags(item, $('.tags', $row));\n}\nfunction renderDonut(item, id) {\n    var columns = [];\n    var sum = 0;\n\n    pushCol('想看', 'wishes');\n    pushCol('在看', 'doings');\n    pushCol('看过', 'collections');\n    pushCol('搁置', 'on_hold');\n    pushCol('抛弃', 'dropped');\n\n    function pushCol(name, key) {\n        var count = item.detail.audience[key] || 0;\n        sum += count;\n        columns.push([name, count]);\n    }\n\n    return c3.generate({\n        size: {\n            height: option.small ? 200 : 300\n        },\n        data: {\n            columns: columns,\n            order: null,\n            type: 'donut'\n        },\n        donut: {\n            title: option.small ? '' : sum + '人收藏'\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderRate(item, id) {\n\n    var column = [];\n    var x = [];\n\n    item.detail.rate.forEach(function (item) {\n        x.push(item.rate);\n        column.push(item.count);\n    });\n\n    column.unshift('rate');\n\n    return c3.generate({\n        size: {\n            height: 240\n        },\n        data: {\n            columns: [column],\n            order: null,\n            type: option.small ? 'bar' : 'area-spline'\n        },\n        axis: {\n            x: {\n                type: 'category',\n                categories: x\n            }\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderGauge(item, id) {\n    return c3.generate({\n        size: {\n            height: 150\n        },\n        data: {\n            columns: [\n                ['评分', item.rate || 0]\n            ],\n            type: 'gauge'\n        },\n        gauge: {\n            min: 5,\n            max: 9,\n            label: {\n                format: function (value, ratio) {\n                    if (!item.rateBy) {\n                        return '评分暂缺';\n                    }\n                    return value.toFixed(1) + '*' + item.rateBy + '人';\n                }\n            }\n        },\n        color: {\n            pattern: ['#AAAAAA', '#2ECC40', '#FF851B', '#FF4136'],\n            threshold: {\n                values: [6.0, 7.5, 9.0]\n            }\n        },\n        bindto: '#' + id\n    });\n}\n\nfunction renderTags(item, $tags) {\n    var cssClass = 'label-primary label-info label-success label-warning label-danger'.split(/ /g);\n    var max = 0;\n    var year = new Date().getFullYear();\n    var tags = item.detail.tags.filter(function (tag) {\n        return -1 === tag.text.indexOf(year);\n    });\n\n    tags.forEach(function (tag) {\n        max = Math.max(max, tag.count);\n    });\n    var rand = Math.seedrandom(item.id, {global: false});\n\n    function pick() {\n        var ans = parseInt(rand() * cssClass.length);\n\n        if (ans == pick.last) {\n            ans = parseInt(rand() * cssClass.length);\n        }\n\n        if (ans == pick.last) {\n            return pick.last = ans = parseInt(rand() * cssClass.length);\n        }\n\n        return pick.last = ans;\n    }\n\n    tags\n//        .sort(function (a, b) {\n//            return b.count - a.count;\n//        })\n        .forEach(function (tag) {\n            var $tag = $('<a>');\n            var weight = Math.pow(tag.count / max, 0.5);\n            $tag\n                .attr('title', '* ' + tag.count)\n                .addClass('label')\n                .addClass(cssClass[pick()])\n                .css('opacity', 0.4 + 0.8 * weight)\n                .css('transform', 'scale('+(Math.min(1, 0.8 + 0.3 * weight))+')')\n                .text(tag.text);\n\n            $tags.append($tag).append(' ');\n        });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./js/rank.main.js\n ** module id = 0\n ** module chunks = 2\n **/"],"sourceRoot":""}