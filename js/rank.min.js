!function(t){function e(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e){function a(t){function e(t){var e=$("[name="+t+"]",n);return r?void e.prop("checked",!!h[t]):void(h[t]=!!e.prop("checked"))}function a(t){var e=$("[name="+t+"]",n);return r?void e.val(h[t]):void(h[t]=e.val())}var n=$(".control-panel"),r=t===!0;a("order"),e("hentai"),e("rateBy"),e("small"),r||(localStorage.option=JSON.stringify(h)),r?l():g()}function n(t){return _(t).filter(function(t){return!h.hentai^r(t)}).filter(function(t){return!h.rateBy||t.rateBy}).sortBy(function(t,e){if("default"===h.order)return-i(t);if("fav"===h.order){var a=0;return _.each(t.detail.audience,function(t){a+=t}),-a}if("rate"===h.order){var n=t.rate;return t.detail.rank&&(n-=1e-7*t.detail.rank),-n}return"rater"===h.order?-(t.rateBy||0):e}).value()}function r(t){return"hentai"in t.detail?t.detail.hentai:t.detail.tags.filter(function(t){return-1!==_.indexOf(["里番","肉番","H","18禁"],t.text)}).length>0}function o(t){function e(t,e){n+=(a[t]||0)*e}var a=t.detail.audience,n=0;return e("collections",1.5),e("doings",.8),e("wishes",.5),e("dropped",-4),e("on_hold",-2),n}function i(t){return Math.pow(t.rate/10,.75)*o(t)}function l(){var t=$(".ctn-list");t.empty().fadeTo(1,.01,function(){var e=$("#tpl-list").html();n(p).forEach(function(a,n){var r=$('<div class="row lazyload">').html(_.template(e)({item:a,option:h})).data("row-item",a);t.append(r)}),t.fadeTo("normal",1)})}function c(t){var e=$(t.target),a=e.data("row-item"),n=_.uniqueId();$(".audience-chart",e).attr("id","_ac_"+n),u(a,"_ac_"+n),$(".gauge-chart",e).attr("id","_g_"+n),s(a,"_g_"+n),$(".rate-chart",e).attr("id","_r_"+n),d(a,"_r_"+n),f(a,$(".tags",e))}function u(t,e){function a(e,a){var o=t.detail.audience[a]||0;r+=o,n.push([e,o])}var n=[],r=0;return a("想看","wishes"),a("在看","doings"),a("看过","collections"),a("搁置","on_hold"),a("抛弃","dropped"),c3.generate({size:{height:h.small?200:300},data:{columns:n,order:null,type:"donut"},donut:{title:h.small?"":r+"人收藏"},bindto:"#"+e})}function d(t,e){var a=[],n=[];return t.detail.rate.forEach(function(t){n.push(t.rate),a.push(t.count)}),a.unshift("rate"),c3.generate({size:{height:240},data:{columns:[a],order:null,type:h.small?"bar":"area-spline"},axis:{x:{type:"category",categories:n}},bindto:"#"+e})}function s(t,e){return c3.generate({size:{height:150},data:{columns:[["评分",t.rate||0]],type:"gauge"},gauge:{min:5,max:9,label:{format:function(e,a){return t.rateBy?e.toFixed(1)+"*"+t.rateBy+"人":"评分暂缺"}}},color:{pattern:["#AAAAAA","#2ECC40","#FF851B","#FF4136"],threshold:{values:[6,7.5,9]}},bindto:"#"+e})}function f(t,e){function a(){var t=parseInt(l()*n.length);return t==a.last&&(t=parseInt(l()*n.length)),t==a.last?a.last=t=parseInt(l()*n.length):a.last=t}var n="label-primary label-info label-success label-warning label-danger".split(/ /g),r=0,o=(new Date).getFullYear(),i=t.detail.tags.filter(function(t){return-1===t.text.indexOf(o)});i.forEach(function(t){r=Math.max(r,t.count)});var l=Math.seedrandom(t.id,{global:!1});i.forEach(function(t){var o=$("<a>"),i=Math.pow(t.count/r,.5);o.attr("title","* "+t.count).addClass("label").addClass(n[a()]).css("opacity",.4+.8*i).css("transform","scale("+Math.min(1,.8+.3*i)+")").text(t.text),e.append(o).append(" ")})}riot.route(function(t){var e=t.slice(1).split(/\//g);return v[e[0]]?void v[e[0]].apply(null,e.slice(1)):void(location="/")});var p=[],h=JSON.parse(localStorage.option||'{"order":"default"}'),g=_.throttle(l,150,{leading:!1}),v={season:function(t){return t.match(/\d{4}-\d{1,2}/)?void $.get("http://7xqy5q.com1.z0.glb.clouddn.com/"+t+".json?"+(localStorage.timestamp||parseInt(Date.now()/72e5))).then(function(t){p=t,a(!0)}):void(location="/")}};$(document).on("lazybeforeunveil",".ctn-list>.row",c).on("change",".control-panel *",a)}]);
//# sourceMappingURL=rank.min.js.map